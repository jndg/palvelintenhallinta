# Infraa koodina

## Tiivistys

### Karvinen 2014: [Hello Salt Infra-as-Code](https://terokarvinen.com/2024/hello-salt-infra-as-code/)

Saltilla voi hallita tuhansia koneita. Tässä artikkelissa opetetaan sen käyttöä, luomalla "Hello, World!" tiedosto.

*1. Asenna salt-minion*
  ```
$ sudo apt-get update
$ sudo apt-get -y install salt-minion
```
Voit käyttää micro-editoria halutessasi
```
$ sudo apt-get -y install micro
$ export EDITOR=micro
```
*3. Luo kansio "hello"-moduulille*
Moduulit asentavat, konfiguroivat ja käynnistävät jonkin asian.
```
$ sudo mkdir -p /srv/salt/hello/
$ cd /srv/salt/hello/
```
/srv/salt/ on kansio, joka jaetaan kaikille orjatietokoneille.

*4. Kirjoita infra koodina*
Varmista että olet oikeassa kansiossa /srv/salt/hello/
```
$ sudoedit init.sls
```
Tänne voimme kirjoittaa idemponttista koodia, esimerkiksi:
```
/tmp/hellotero:
  file.managed
```
*5. Suorita*
```
$ sudo salt-call --local state.apply hello
```
Tuloksena yksityiskohtainen selitys siitä mitä tehtiin.

"file /tmp/hellotero created"

Varmistetaan, että salt teki mitä piti:
```
$ ls /tmp/hellotero
/tmp/hellotero
```

*Idempotenssi*

Ensimmäisellä kerralla salt tekee muutoksia, mutta seuraavilla kerroilla ajettaessa salt ei tee muutoksia, koska tiedosto on jo halutussa tilassa.

*Tärkeät tilatoiminnot ovat*

    pkg
    file
    service
    user
    cmd (vain jos neljää muuta ei voida käyttää).

### Salt contributors: [Salt overview](https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml)
   
   -Salt käyttää YAML:ia tiedostojen pohjana ja muuntaa sen Python-rakenteiksi.

*Rules of YAML*

  -Tieto on jäsennetty ```key: value``` -pareiksi.

  -Mappings käyttää kaksoispistettä ja yhtä välilyöntiä (": ”) merkitsemään key: value -pareja.

  -Avainten (key) arvo voi olla monessa eri rakenteessa.

  -Kaikki avaimet/ominaisuudet ovat isojen ja pienten kirjainten välisiä.

  -Välimerkit EIVÄT ole sallittuja, käytä VAIN välilyöntejä.

  -Kommentit alkavat hash-merkillä ”#”.

*YAML simple structure*

YAML koostuu kolmesta peruselementtityypistä:

```Scalars```
```Lists```
```Dictionaries```

*Lists and dictionaries - YAML block structures*

YAML on järjestetty lohkorakenteisiin.

-sisennys määrittää rakenteen, standardi on 2 välilyöntiä
-Kokoelmat (list, or dictionary block sequence) merkitään väliviivalla ja välilyönnillä ("- ”).


## Lähteet
Tehtävien anto: https://terokarvinen.com/palvelinten-hallinta/

Salt contributors: Salt overview. Luettavissa: https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml Luettu:14.04.2025
Karvinen 2014: Hello Salt Infra-as-Code. Luettavissa: https://terokarvinen.com/2024/hello-salt-infra-as-code/ Luettu:14.04.2025


Tätä dokumenttia saa kopioida ja muokata GNU General Public License (versio 2 tai uudempi) mukaisesti. http://www.gnu.org/licenses/gpl.html

Pohjana Tero Karvinen 2025: Palvelinten Hallinta- kurssi, http://terokarvinen.com

